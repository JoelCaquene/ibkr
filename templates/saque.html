{% extends "base.html" %}
{% load static %}

{% block title %}Levantamento de Salário{% endblock %}

{% block content %}
<div class="forex-bg">
    <div class="saque-wrapper">
        
        <div class="top-nav-saque">
            <a href="{% url 'perfil' %}" class="btn-back">
                <i class="fas fa-chevron-left"></i>
            </a>
        </div>

        <div class="saque-card">
            <div class="card-header-saque">
                <i class="fas fa-university"></i>
                <h2>Levantamento</h2>
                <div class="balance-badge">
                    Saldo: <span>{{ request.user.available_balance|default:"0.00" }} KZ</span>
                </div>
            </div>

            {# Área de Mensagens Django #}
            {% if messages %}
                <ul class="messages-custom">
                    {% for message in messages %}
                        <li class="{% if message.tags %}{{ message.tags }}{% else %}info{% endif %}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            {# BLOCO DE DOMINGO (ALERTA ORGANIZADO) #}
            <div id="sunday-warning" style="display: none;">
                <div class="alert-box-sunday">
                    <i class="fas fa-calendar-times"></i>
                    <p><strong>Aviso Importante</strong><br>
                    Caro cliente, hoje é domingo. O saque está disponível apenas de segunda a sábado. Hoje apenas depósitos estão disponíveis. Obrigado.</p>
                </div>
            </div>

            {% if not has_bank_details %}
                <div class="alert-box-saque" id="bank-warning">
                    <i class="fas fa-exclamation-circle"></i> 
                    <p>Adicione suas coordenadas bancárias no Perfil antes de sacar.</p>
                </div>
            {% endif %}

            <form method="post" id="form-saque">
                {% csrf_token %}
                
                <div class="input-section">
                    <label><i class="fas fa-money-bill-wave"></i> Valor a Sacar (KZ):</label>
                    <div class="input-container-custom">
                        {{ form.amount }}
                    </div>
                </div>

                <div class="quick-values-grid">
                    <button type="button" class="val-btn" onclick="setAmount(3000)">3.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(6000)">6.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(18000)">18.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(55000)">55.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(120000)">120.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(200000)">200.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(500000)">500.000</button>
                    <button type="button" class="val-btn" onclick="setAmount(800000)">800.000</button>
                </div>

                <button type="submit" id="btn-submit-saque" class="confirm-saque-btn" {% if not has_bank_details %}disabled{% endif %}>
                    <i class="fas fa-check-double"></i> <span>CONFIRMAR</span>
                </button>
            </form>

            <div class="min-amount-footer">
                Saque mínimo permitido: <strong>3.000 KZ</strong>
            </div>
        </div>
    </div>
</div>

<style>
    /* Estilos Adicionais para Domingo */
    .alert-box-sunday {
        background: rgba(255, 77, 77, 0.15);
        border: 1px solid #ff4d4d;
        color: #ff4d4d;
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 20px;
        animation: shake 0.5s ease-in-out;
    }
    .alert-box-sunday i { font-size: 1.5rem; margin-bottom: 8px; }
    .alert-box-sunday p { margin: 0; font-size: 0.9rem; line-height: 1.4; color: #fff; }
    .alert-box-sunday strong { color: #ff4d4d; text-transform: uppercase; }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    /* Fundo Forex Azul Escuro */
    .forex-bg {
        background: radial-gradient(circle at center, #0a192f 0%, #02060c 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 10px;
        position: relative;
        overflow: hidden;
    }

    .forex-bg::before {
        content: "";
        position: absolute;
        top: -50%; left: -50%; width: 200%; height: 200%;
        background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        opacity: 0.1;
        pointer-events: none;
    }

    .saque-wrapper {
        width: 100%;
        max-width: 500px;
        z-index: 2;
        margin-top: 10px;
    }

    .btn-back {
        color: #00d4ff;
        text-decoration: none;
        font-size: 1.5rem;
        display: inline-flex;
        transition: 0.3s;
    }

    .saque-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 20px;
        padding: 25px 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }

    .card-header-saque { text-align: center; margin-bottom: 20px; }
    .card-header-saque i { font-size: 2.2rem; color: #00d4ff; text-shadow: 0 0 15px rgba(0, 212, 255, 0.5); }
    .card-header-saque h2 { color: #fff; font-size: 1.3rem; margin: 10px 0; }

    .balance-badge {
        background: rgba(0, 212, 255, 0.15);
        color: #00d4ff;
        display: inline-block;
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 0.85rem;
        border: 1px solid rgba(0, 212, 255, 0.3);
    }

    .input-container-custom input {
        width: 100%;
        background: rgba(0, 0, 0, 0.4) !important;
        border: 1px solid rgba(0, 212, 255, 0.4) !important;
        border-radius: 10px !important;
        padding: 12px !important;
        color: #fff !important;
        font-size: 1.6rem !important;
        text-align: center;
        outline: none;
    }

    .quick-values-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
        margin: 15px 0;
    }

    .val-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #ccd6f6;
        padding: 12px 2px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
    }

    .confirm-saque-btn {
        width: 100%;
        padding: 16px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #00d4ff 0%, #0072ff 100%);
        color: white;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .confirm-saque-btn:disabled {
        background: #233554 !important;
        color: #495670 !important;
        cursor: not-allowed;
        box-shadow: none;
        filter: grayscale(1);
    }

    .messages-custom { list-style: none; padding: 0; margin-bottom: 15px; }
    .messages-custom li { padding: 10px; border-radius: 8px; text-align: center; font-size: 0.85rem; margin-bottom: 8px; }
    .messages-custom .success { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid #2ecc71; }
    .messages-custom .error { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }

    .min-amount-footer { text-align: center; color: #495670; font-size: 0.75rem; margin-top: 15px; }

    .alert-box-saque {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid #ffc107;
        color: #ffc107;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.8rem;
        margin-bottom: 15px;
        text-align: center;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const today = new Date();
        const isSunday = today.getDay() === 0; // 0 é Domingo
        
        const submitBtn = document.getElementById('btn-submit-saque');
        const sundayWarning = document.getElementById('sunday-warning');
        const bankWarning = document.getElementById('bank-warning');
        const formSaque = document.getElementById('form-saque');

        if (isSunday) {
            // Mostrar aviso de domingo
            sundayWarning.style.display = 'block';
            
            // Esconder aviso de banco (opcional para limpar a tela)
            if (bankWarning) bankWarning.style.display = 'none';
            
            // Desativar botão e mudar texto
            submitBtn.disabled = true;
            submitBtn.querySelector('span').innerText = "INDISPONÍVEL HOJE";
            
            // Impedir envio do formulário
            formSaque.onsubmit = function(e) {
                e.preventDefault();
                return false;
            };
        }
    });

    function setAmount(val) {
        const input = document.querySelector('input[name="amount"]');
        if (input) {
            input.value = val;
            input.focus();
        }
    }
</script>
{% endblock %}
